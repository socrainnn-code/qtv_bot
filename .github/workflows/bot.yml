name: QTV Bot Test

on: [workflow_dispatch]

jobs:
  test-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        cd src
        pip install -r requirements.txt

    - name: Test environment
      env:
        TWITTER_BEARER_TOKEN: ${{ secrets.TWITTER_BEARER_TOKEN }}
        SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
      run: |
        cd src
        echo "Testing environment variables..."
        python -c "
        import os
        required_vars = ['TWITTER_BEARER_TOKEN', 'SPREADSHEET_ID']
        for var in required_vars:
            value = os.getenv(var)
            if value:
                print(f'✅ {var}: SET')
            else:
                print(f'❌ {var}: MISSING')
        "

    - name: Test Google credentials
      run: |
        cd src
        echo '${{ secrets.GOOGLE_CREDENTIALS }}' > credentials.json
        python -c "
        try:
            import json
            with open('credentials.json') as f:
                data = json.load(f)
            print('✅ Google credentials: VALID')
            print(f'   Client email: {data.get(\"client_email\", \"NOT_FOUND\")}')
        except Exception as e:
            print(f'❌ Google credentials error: {e}')
        "

    - name: Show success message
      run: echo "✅ All tests passed! Ready to run the bot."
