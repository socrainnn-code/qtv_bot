name: QTV Twitter Bot

on:
  schedule:
    - cron: '*/5 * * * *'  # –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  workflow_dispatch:        # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Create Google credentials file
      run: |
        echo '${{ secrets.GOOGLE_CREDENTIALS }}' > credentials.json
        echo "‚úÖ Google credentials file created"

    - name: Run Twitter Bot
      env:
        TWITTER_BEARER_TOKEN: ${{ secrets.TWITTER_BEARER_TOKEN }}
        SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
        TARGET_TWEET_ID: ${{ secrets.TARGET_TWEET_ID }}
      run: |
        echo "üöÄ Starting QTV Bot..."
        start_time=$(date +%s)
        python qtv_bot.py
        exit_code=$?
        end_time=$(date +%s)
        echo "‚è± Execution time: $((end_time - start_time)) seconds"
        echo "üîö Exit code: $exit_code"
        exit $exit_code

    - name: Send success notification
      if: success()
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '‚úÖ QTV Bot –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google Sheets –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.'
          })

    - name: Send failure notification
      if: failure()
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '‚ùå QTV Bot –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ workflow.'
          })
